<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <title>Card Soja - Supabase</title>
  <style>
    .card {
      border: 1px solid #ccc;
      padding: 15px;
      width: 300px;
      border-radius: 8px;
      font-family: Arial;
    }
    input {
      width: 100%;
      padding: 8px;
      margin-bottom: 10px;
    }
    .btn2 {
      background: green;
      color: white;
      padding: 8px 12px;
      border: none;
      border-radius: 4px;
      cursor: pointer;
    }
  </style>
</head>
<body>
  <div class="card">
    <h3>Soja</h3>
    <input type="number" id="estoqueAtual" placeholder="Estoque Atual" />
    <input type="number" id="meta" placeholder="Meta" />
    <input type="number" id="recebimento" placeholder="Recebimento" />
    <p>Preço: R$ <span>114,50</span></p>
    <button class="btn2" onclick="salvarDados()">Atualizar</button>
    <div id="ultimosDados"></div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js"></script>
  <script>
    const SUPABASE_URL = "https://dylziaqkyavkfwjepqkp.supabase.co";
    const SUPABASE_ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImR5bHppYXFreWF2a2Z3amVwcWtwIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTI0NTc1OTgsImV4cCI6MjA2ODAzMzU5OH0.gy5jXxKOTgeCf0Rwq7ktLTz1pyoZ8dJjZOK9UB9rHCM";

    const supabase = supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

    async function salvarDados() {
      const estoqueAtual = document.getElementById("estoqueAtual").value;
      const meta = document.getElementById("meta").value;
      const recebimento = document.getElementById("recebimento").value;

      if (!estoqueAtual || !meta || !recebimento) {
        alert("Preencha todos os campos.");
        return;
      }

      const { error } = await supabase
        .from("soja")
        .insert([
          {
            estoqueatual: Number(estoqueAtual),
            meta: Number(meta),
            recebimento: Number(recebimento),
            timestamp: new Date()
          }
        ]);

      if (error) {
        alert("Erro ao salvar: " + error.message);
      } else {
        alert("Salvo com sucesso!");
        carregarUltimo();
      }
    }

    async function carregarUltimo() {
      const { data, error } = await supabase
        .from("soja")
        .select("*")
        .order("timestamp", { ascending: false })
        .limit(1);

      if (error || !data || data.length === 0) {
        document.getElementById("ultimosDados").innerText = "Nenhum dado ainda.";
        return;
      }

      const item = data[0];
      document.getElementById("ultimosDados").innerHTML = `
        <strong>Último Registro:</strong><br>
        Estoque Atual: ${item.estoqueatual}<br>
        Meta: ${item.meta}<br>
        Recebimento: ${item.recebimento}
      `;
    }

    carregarUltimo();
  </script>
</body>
</html>


