<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8" />
  <title>Dashboard</title>
  <style>
    /* CONTAINER PRINCIPAL */
.main {
  display: flex;
  flex-wrap: wrap;
  gap: 1em;
  justify-content: center;
  padding-top: 2em;
}

/* CARD */
.card {
  width: 200px;
  background: white;
  border-radius: 15px;
  box-shadow: rgba(0, 0, 0, 0.07) 0px 2px 4px, rgba(0, 0, 0, 0.07) 0px 4px 8px;
  padding: 1em;
  text-align: center;
  transition: transform 0.3s ease, box-shadow 0.3s ease;
}

.card:hover {
  transform: translateY(-5px);
  box-shadow: 0 10px 20px rgba(0, 0, 0, 0.15);
}

/* TÍTULO */
.heading {
  color: black;
  font-weight: bold;
  font-size: 1.2em;
  margin-bottom: 0.5em;
}

/* DETALHES */
.details {
  color: #333;
  font-size: 0.9em;
  text-align: left;
  margin: 1em 0;
  padding: 0 0.5em;
  line-height: 1.4em;
  word-break: break-word;
}

/* PREÇO */
.price {
  color: black;
  font-weight: bold;
  font-size: 1em;
  margin-bottom: 0.8em;
}

/* BOTÃO EDITAR */
.btn-editar {
  padding: 8px 12px;
  background-color: #007bff;
  color: white;
  border: none;
  border-radius: 6px;
  cursor: pointer;
  font-size: 0.85em;
  width: 100%;
  transition: background-color 0.3s ease;
}

.btn-editar:hover {
  background-color: #0056b3;
}

/* FORMULÁRIOS */
.form-container {
  display: none;
  flex-wrap: wrap;
  gap: 2em;
  justify-content: center;
  padding: 2em;
}

form {
  width: 260px;
  border: 1px solid #ddd;
  padding: 20px;
  border-radius: 10px;
  background: #f9f9f9;
}

/* CAMPOS DE INPUT */
input {
  width: 100%;
  padding: 10px;
  margin-top: 10px;
  box-sizing: border-box;
}

/* BOTÃO SALVAR */
button {
  width: 100%;
  padding: 10px;
  margin-top: 15px;
  background-color: #28a745;
  color: white;
  border: none;
  cursor: pointer;
  transition: background-color 0.3s ease;
}

button:hover {
  background-color: #218838;
}

/* MENSAGEM */
.mensagem {
  margin-top: 10px;
  font-weight: bold;
  font-size: 0.85em;
}

  </style>
</head>
<body>

<!-- CARDS -->
<div class="main">
  <!-- Soja -->
  <div class="card">
    <div class="heading">Soja</div>
    <div class="details" id="detalhes-soja">Estoque Atual: -- <br> Meta: -- <br> Recebimento: --</div>
    <div class="price" id="preco-soja">R$: --</div>
    <button onclick="mostrarFormulario('formSoja')" class="btn-editar">Editar</button>
  </div>
  <!-- Milho -->
  <div class="card">
    <div class="heading">Milho</div>
    <div class="details" id="detalhes-milho">Estoque Atual: -- <br> Meta: -- <br> Recebimento: --</div>
    <div class="price" id="preco-milho">R$: --</div>
    <button onclick="mostrarFormulario('formMilho')" class="btn-editar">Editar</button>
  </div>
  <!-- Trigo -->
  <div class="card">
    <div class="heading">Trigo</div>
    <div class="details" id="detalhes-trigo">Estoque Atual: -- <br> Meta: -- <br> Recebimento: --</div>
    <div class="price" id="preco-trigo">R$: --</div>
    <button onclick="mostrarFormulario('formTrigo')" class="btn-editar">Editar</button>
  </div>
  <!-- Lenha -->
  <div class="card">
    <div class="heading">Lenha</div>
    <div class="details" id="detalhes-lenha">Estoque Atual: -- <br> Meta: -- <br> Recebimento: --</div>
    <div class="price" id="preco-lenha">R$: --</div>
    <button onclick="mostrarFormulario('formLenha')" class="btn-editar">Editar</button>
  </div>
  <!-- Armazenamento -->
  <div class="card">
    <div class="heading">Armazenamento</div>
    <div class="details" id="detalhes-armazenamento">Capacidade: -- <br> Utilizado: -- <br> Disponível: --</div>
    <div class="price" id="preco-armazenamento">R$: --</div>
    <button onclick="mostrarFormulario('formArmazenamento')" class="btn-editar">Editar</button>
  </div>
  <!-- Pessoa -->
  <div class="card">
    <div class="heading">Pessoa</div>
    <div class="details" id="detalhes-pessoa">Funcionários: -- <br> Ativos: -- <br> Inativos: --</div>
    <div class="price" id="preco-pessoa">R$: --</div>
    <button onclick="mostrarFormulario('formPessoa')" class="btn-editar">Editar</button>
  </div>
  <!-- Estoque Geral -->
  <div class="card">
    <div class="heading">Estoque Geral</div>
    <div class="details" id="detalhes-geral">Total: -- <br> Entrada: -- <br> Saída: --</div>
    <div class="price" id="preco-geral">R$: --</div>
    <button onclick="mostrarFormulario('formGeral')" class="btn-editar">Editar</button>
  </div>
</div>

<!-- FORMULÁRIOS -->
<div class="form-container" id="formularios">
  <!-- Formulário Soja -->
<form id="formSoja" style="display:none;">
  <h2>Cadastro Soja</h2>
  <label>Estoque Atual:</label><input type="number" id="estoqueatual_soja" required>
  <label>Meta:</label><input type="number" id="meta_soja" required>
  <label>Recebimento:</label><input type="number" id="recebimento_soja" required>
  <label>Percentual Meta:</label><input type="number" id="percentual_metal_soja" required>
  <button type="submit">Salvar</button>
  <div class="mensagem" id="mensagem_soja"></div>
</form>

<!-- Formulário Milho -->
<form id="formMilho" style="display:none;">
  <h2>Cadastro Milho</h2>
  <label>Estoque Atual:</label><input type="number" id="estoqueatual_milho" required>
  <label>Meta:</label><input type="number" id="meta_milho" required>
  <label>Recebimento:</label><input type="number" id="recebimento_milho" required>
  <label>Percentual Meta:</label><input type="number" id="percentual_metal_milho" required>
  <button type="submit">Salvar</button>
  <div class="mensagem" id="mensagem_milho"></div>
</form>

  <!-- Formulário Trigo -->
  <form id="formTrigo" style="display:none;">
    <h2>Cadastro Trigo</h2>
    <label>Estoque Atual:</label><input type="number" id="estoque_trigo" required>
    <label>Meta:</label><input type="number" id="meta_trigo" required>
    <label>Recebimento:</label><input type="number" id="recebimento_trigo" required>
    <label>Percentual Meta:</label><input type="number" id="percentual_metal_trigo" required>
    <button type="submit">Salvar</button>
    <div class="mensagem" id="mensagem_trigo"></div>
  </form>

  <!-- Formulário Lenha -->
  <form id="formLenha" style="display:none;">
    <h2>Cadastro Lenha</h2>
    <label>Estoque Atual:</label><input type="number" id="estoque_lenha" required>
    <label>Meta:</label><input type="number" id="meta_lenha" required>
    <label>Recebimento:</label><input type="number" id="recebimento_lenha" required>
    <label>Percentual Meta:</label><input type="number" id="percentual_metal_lenha" required>
    <button type="submit">Salvar</button>
    <div class="mensagem" id="mensagem_lenha"></div>
  </form>

  <!-- Formulário Armazenamento -->
  <form id="formArmazenamento" style="display:none;">
    <h2>Cadastro Armazenamento</h2>
    <label>Capacidade Total:</label><input type="number" id="capacidade_total" required>
    <label>Utilizado:</label><input type="number" id="utilizado" required>
    <label>Disponível:</label><input type="number" id="disponivel" required>
    <button type="submit">Salvar</button>
    <div class="mensagem" id="mensagem_armazenamento"></div>
  </form>

  <!-- Formulário Pessoa -->
  <form id="formPessoa" style="display:none;">
    <h2>Cadastro Pessoa</h2>
    <label>Total Funcionários:</label><input type="number" id="total_funcionarios" required>
    <label>Ativos:</label><input type="number" id="ativos" required>
    <label>Inativos:</label><input type="number" id="inativos" required>
    <button type="submit">Salvar</button>
    <div class="mensagem" id="mensagem_pessoa"></div>
  </form>

  <!-- Formulário Estoque Geral -->
  <form id="formGeral" style="display:none;">
    <h2>Cadastro Estoque Geral</h2>
    <label>Estoque Total:</label><input type="number" id="estoque_total" required>
    <label>Entrada:</label><input type="number" id="entrada" required>
    <label>Saída:</label><input type="number" id="saida" required>
    <label>Saldo:</label><input type="number" id="saldo" required>
    <button type="submit">Salvar</button>
    <div class="mensagem" id="mensagem_geral"></div>
  </form>
</div>

<script>
  function mostrarFormulario(id) {
    const forms = document.querySelectorAll('.form-container form');
    forms.forEach(form => form.style.display = 'none');
    document.querySelector('.form-container').style.display = 'flex';
    document.getElementById(id).style.display = 'block';
  }
</script>

<script type="module">
  import { createClient } from 'https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm';

  const supabase = createClient(
    'https://dylziaqkyavkfwjepqkp.supabase.co',
    'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImR5bHppYXFreWF2a2Z3amVwcWtwIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTI0NTc1OTgsImV4cCI6MjA2ODAzMzU5OH0.gy5jXxKOTgeCf0Rwq7ktLTz1pyoZ8dJjZOK9UB9rHCM'
  );

  window.addEventListener('DOMContentLoaded', async () => {
    const cards = [
      { nome: 'soja', campos: ['estoqueatual', 'meta', 'recebimento', 'percentual_metal'] },
      { nome: 'milho', campos: ['estoqueatual', 'meta', 'recebimento', 'percentual_metal'] },
      { nome: 'trigo', campos: ['estoqueatual', 'meta', 'recebimento', 'percentual_metal'] },
      { nome: 'lenha', campos: ['estoqueatual', 'meta', 'recebimento', 'percentual_metal'] },
      { nome: 'armazenamento', campos: ['capacidade_total', 'utilizado', 'disponivel'] },
      { nome: 'pessoa', campos: ['total_funcionarios', 'ativos', 'inativos'] },
      { nome: 'geral', campos: ['estoque_total', 'entrada', 'saida', 'saldo'] },
    ];

    for (const { nome, campos } of cards) {
      const { data, error } = await supabase.from(nome).select('*').order('timestamp', { ascending: false }).limit(1);
      if (error) continue;
      if (!data || data.length === 0) continue;
      const dados = data[0];
      const detalhes = campos.map(c => `${c.replace('_', ' ')}: ${dados[c] ?? '--'}`).join(' <br> ');
      const preco = dados.percentual_metal || dados.saldo || dados.disponivel || dados.inativos || '--';
      document.getElementById(`detalhes-${nome}`).innerHTML = detalhes;
      document.getElementById(`preco-${nome}`).innerText = `R$: ${parseFloat(preco).toFixed(2)}`;

      // preencher campos do formulário com último registro
      campos.forEach(campo => {
        const input = document.getElementById(`${campo}_${nome}`) || document.getElementById(campo);
        if (input) input.value = dados[campo] ?? '';
      });
    }
  });

  const formularios = document.querySelectorAll('form');
  formularios.forEach(form => {
    form.addEventListener('submit', async (e) => {
      e.preventDefault();
      const id = form.id.replace('form', '').toLowerCase();
      const inputs = form.querySelectorAll('input');
      const dados = { timestamp: new Date().toISOString() };
      inputs.forEach(input => dados[input.id.replace(`_${id}`, '')] = parseFloat(input.value));

      const { error } = await supabase.from(id).insert([dados]);
      const msg = form.querySelector('.mensagem');
      msg.innerHTML = error ? `<span style='color:red;'>Erro: ${error.message}</span>` : `<span style='color:green;'>Salvo com sucesso!</span>`;
      if (!error) form.reset();
    });
  });
</script>


</body>
</html>
