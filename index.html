<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <title>Dashboard Agrícola</title>
  <!-- Import da lib do Supabase -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <style>
    /* Layout simples de cards */
    .card { border: 1px solid #ccc; border-radius: 8px; padding: 16px; width: 200px; margin: 8px; display: inline-block; vertical-align: top; }
    .card h3 { margin-top: 0; }
    .cards-container { text-align: center; }
  </style>
</head>
<body>
  <h1>Dashboard de Estoques</h1>
  <div class="cards-container">
    <div class="card">
      <h3>Soja</h3>
      <p>Estoque: <span id="soja-estoque">–</span></p>
      <p>Meta: <span id="soja-meta">–</span></p>
    </div>
    <div class="card">
      <h3>Milho</h3>
      <p>Estoque: <span id="milho-estoque">–</span></p>
      <p>Meta: <span id="milho-meta">–</span></p>
    </div>
    <div class="card">
      <h3>Trigo</h3>
      <p>Estoque: <span id="trigo-estoque">–</span></p>
      <p>Meta: <span id="trigo-meta">–</span></p>
    </div>
  </div>

  <script>
    // 1) Configuração do cliente Supabase
    const SUPABASE_URL = 'https://dylziaqkyavkfwjepqkp.supabase.co';
    const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImR5bHppYXFreWF2a2Zmd2plcXBrcCIsInJvbGUiOiJhbm9uIiwiaWF0IjoxNzUyNDU3NTk4LCJleHAiOjIwNjgwMzM1OTh9.gy5jXxKOTgeCf0Rwq7ktLTz1pyoZ8dJjZOK9UB9rHCM';
    const supabase = supabasejs.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

    // 2) Função genérica para buscar valores de uma tabela
    async function fetchValores(tabela) {
      const { data, error } = await supabase
        .from(tabela)
        .select('estoqueAtual, meta')
        .order('timestamp', { ascending: false })
        .limit(1);

      if (error) {
        console.error(`Erro ao buscar ${tabela}:`, error);
        return null;
      }
      return data && data.length ? data[0] : null;
    }

    // 3) Preenche um card dado um prefixo de ID e os dados
    function preencherCard(prefixo, dados) {
      if (!dados) return;
      document.getElementById(`${prefixo}-estoque`).textContent = dados.estoqueAtual;
      document.getElementById(`${prefixo}-meta`).textContent    = dados.meta;
    }

    // 4) Carrega todos os dados e atualiza a UI
    async function carregarDashboard() {
      const soja  = await fetchValores('soja');
      const milho = await fetchValores('milho');
      const trigo = await fetchValores('trigo');

      preencherCard('soja', soja);
      preencherCard('milho', milho);
      preencherCard('trigo', trigo);
    }

    // 5) Executa ao carregar a página
    window.addEventListener('DOMContentLoaded', carregarDashboard);
  </script>
</body>
</html>


